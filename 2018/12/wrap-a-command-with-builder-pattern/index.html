<!DOCTYPE html>
<html lang="en">
<head><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WQ9YVRG232"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-WQ9YVRG232');
</script>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<meta name="description" content="This article shows a well-designed way to wrap a command and expose it through API with the classic Builder pattern. In this tutorial, you will learn how to write the Builder pattern, and how to direct standard output stream and standard error stream from the command to the input stream of your API.</p>
">
<title>Wrap A Command with Builder Pattern - Zhenyang Hua</title>
  <link rel="stylesheet" href="/assets/global.c9414973.css">
<link rel="stylesheet" href="/assets/style.module.184703f0.css"></head>
<body><div id="contentcontainer" class="shadow"><div class="host_1vq48fc" style="background-color: rgb(75, 241, 97);"><header><div class="host_1q8y6om"><a href="#maincontent">skip to main content</a></div><div class="host_216t9o"><h2 class="title_216t9o"><a href="/">Zhenyang Hua</a></h2></div><div class="host_m2uvri"><nav><h2 class="hidden">Main Navigation</h2><ul><li><a href="/" class="link_m2uvri">Tools</a></li><li><a href="/writings/1" class="link_m2uvri">Writings</a></li></ul></nav></div><div class="host_1c336ft"><span>This is a space that holds a collection of my personal work and ideas</span></div></header></div><main id="maincontent"><div class="post_14b9dxr"><h1 class="title_14b9dxr">Wrap A Command with Builder Pattern</h1><p class="date_14b9dxr">Posted on 12/19/2018</p><div class="summary_14b9dxr"><p>This article shows a well-designed way to wrap a command and expose it through API with the classic Builder pattern. In this tutorial, you will learn how to write the Builder pattern, and how to direct standard output stream and standard error stream from the command to the input stream of your API.</p>
</div><article><p>In a scenario that we have this command line application that will send some information to a server developed using some exotic framework or in a completely a different programming language, which increase the difficulty to reference it directly in your client application. It is used so often in the integration test that you feel the strong need to convert it to an API so that your projects could use it directly from your code without the knowledge on what exactly the correct command line is to have it send the correct information. If this scenario is too complicated for you, let&#39;s just say you want to run a command that execute a jar file with some command line arguments. Usually, you would do something like this:</p>
<div class="codeblock">
  <pre>java -jar hello-world.jar --foo=bar</pre>
</div><p>That will do the job. But if you want to invoke it from your java application and pass in various configuration arguments, you will likely constructor a string and then execute it from the runtime:</p>
<div class="codeblock">
  <pre class="language-java"><span class="token class-name">String</span> cmd <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"java -jar "%s""</span> <span class="token operator">+</span>
                        <span class="token string">" --meter.feature-service="%s""</span> <span class="token operator">+</span>
                        <span class="token string">" --meter.description="%s""</span> <span class="token operator">+</span>
                        <span class="token string">" --meter.manufacture="%s""</span> <span class="token operator">+</span>
                        <span class="token string">" --meter.model-number="%s""</span> <span class="token operator">+</span>
                        <span class="token string">" --meter.lifecycle-status.recruited="%s""</span> <span class="token operator">+</span>
                        <span class="token string">" --meter.lifecycle-status.decommissioned="%s""</span> <span class="token operator">+</span>
                        <span class="token string">" --meter.total.recruited=%d"</span> <span class="token operator">+</span>
                        <span class="token string">" --meter.total.decommissioned=%d"</span><span class="token punctuation">,</span>
                path<span class="token punctuation">,</span>
                featureService<span class="token punctuation">,</span>
                description<span class="token punctuation">,</span>
                manufacture<span class="token punctuation">,</span>
                model<span class="token punctuation">,</span>
                lifecycleRecruited<span class="token punctuation">,</span>
                lifecycleDecommissioned<span class="token punctuation">,</span>
                totalRecruited<span class="token punctuation">,</span>
                totalDecommissioned<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Process</span> process <span class="token operator">=</span> <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre>  
</div><p>This is a good start because we already start to externalize the key parameters to provide limit flexibility to the client. In the above example, there are many configurable properties needs to be passed in from the client. We could have just created a number of setters with an empty argument constructor leave the rest to the client, but we are better than this. There are two improvements we could do.</p>
<ol>
<li><p>Use Builder Pattern for Object Creation. A classic way to implement the Builder pattern is to use a nested class (static inner class) and make the constructor of the class of the object you want to build private. This way, we could assign default values to the optional parameters and enforce required parameters through the Builder constructor.</p>
</li>
<li><p>Direct the output stream from the target command to the input stream of the current program.</p>
</li>
</ol>
<p>Here is an example of the Builder pattern to provide the flexibility and minimal client code for clients to use.</p>
<div class="codeblock">
  <pre class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MeterSimulator</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> path<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> featureService<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> description<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> manufacture<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> model<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> lifecycleRecruited<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> lifecycleDecommissioned<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> totalRecruited<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> totalDecommissioned<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Builder</span> <span class="token punctuation">{</span>
        <span class="token comment">// Required</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> path<span class="token punctuation">;</span>

        <span class="token comment">// Optional</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> featureService <span class="token operator">=</span> <span class="token string">"https://example.com/arcgis/rest/services/MeterMiles/FeatureServer/1"</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> description <span class="token operator">=</span> <span class="token string">"abcdefghijklmnopqrstuvwxyz"</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> manufacture <span class="token operator">=</span> <span class="token string">"ACME"</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> model <span class="token operator">=</span> <span class="token string">"Integration"</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> lifecycleRecruited <span class="token operator">=</span> <span class="token string">"New"</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> lifecycleDecommissioned <span class="token operator">=</span> <span class="token string">"Decom"</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> totalRecruited <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> totalDecommissioned <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token comment">/**
         * constructor
         * @param path path to the meter-simulate.jar
         */</span>
        <span class="token keyword">public</span> <span class="token class-name">Builder</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>path <span class="token operator">=</span> path<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">Builder</span> <span class="token function">withFeatureService</span><span class="token punctuation">(</span><span class="token class-name">String</span> featureService<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>featureService <span class="token operator">=</span> featureService<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">Builder</span> <span class="token function">withDescription</span><span class="token punctuation">(</span><span class="token class-name">String</span> description<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>description <span class="token operator">=</span> description<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">Builder</span> <span class="token function">withManufacture</span><span class="token punctuation">(</span><span class="token class-name">String</span> manufacture<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>manufacture <span class="token operator">=</span> manufacture<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">Builder</span> <span class="token function">withModel</span><span class="token punctuation">(</span><span class="token class-name">String</span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>model <span class="token operator">=</span> model<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">Builder</span> <span class="token function">withLifecycleRecruited</span><span class="token punctuation">(</span><span class="token class-name">String</span> lifecycleRecruited<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>lifecycleRecruited <span class="token operator">=</span> lifecycleRecruited<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">Builder</span> <span class="token function">withLifecycleDecommissioned</span><span class="token punctuation">(</span><span class="token class-name">String</span> lifecycleDecommissioned<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>lifecycleDecommissioned <span class="token operator">=</span> lifecycleDecommissioned<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">Builder</span> <span class="token function">withTotalRecruited</span><span class="token punctuation">(</span><span class="token keyword">int</span> totalRecruited<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>totalRecruited <span class="token operator">=</span> totalRecruited<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">Builder</span> <span class="token function">withTotalDecommissioned</span><span class="token punctuation">(</span><span class="token keyword">int</span> totalDecommissioned<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>totalDecommissioned <span class="token operator">=</span> totalDecommissioned<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">MeterSimulator</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MeterSimulator</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> cmd <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"java -jar "%s""</span> <span class="token operator">+</span>
                        <span class="token string">" --meter.feature-service="%s""</span> <span class="token operator">+</span>
                        <span class="token string">" --meter.description="%s""</span> <span class="token operator">+</span>
                        <span class="token string">" --meter.manufacture="%s""</span> <span class="token operator">+</span>
                        <span class="token string">" --meter.model-number="%s""</span> <span class="token operator">+</span>
                        <span class="token string">" --meter.lifecycle-status.recruited="%s""</span> <span class="token operator">+</span>
                        <span class="token string">" --meter.lifecycle-status.decommissioned="%s""</span> <span class="token operator">+</span>
                        <span class="token string">" --meter.total.recruited=%d"</span> <span class="token operator">+</span>
                        <span class="token string">" --meter.total.decommissioned=%d"</span><span class="token punctuation">,</span>
                path<span class="token punctuation">,</span>
                featureService<span class="token punctuation">,</span>
                description<span class="token punctuation">,</span>
                manufacture<span class="token punctuation">,</span>
                model<span class="token punctuation">,</span>
                lifecycleRecruited<span class="token punctuation">,</span>
                lifecycleDecommissioned<span class="token punctuation">,</span>
                totalRecruited<span class="token punctuation">,</span>
                totalDecommissioned<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Process</span> process <span class="token operator">=</span> <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Redirect output stream of the command to the input stream of current program</span>
        <span class="token keyword">try</span><span class="token punctuation">(</span><span class="token class-name">BufferedReader</span> stdIn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">BufferedReader</span> stdErr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">getErrorStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token class-name">String</span> s<span class="token punctuation">;</span>

            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s <span class="token operator">=</span> stdIn<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>s <span class="token operator">=</span> stdErr<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">MeterSimulator</span><span class="token punctuation">(</span><span class="token class-name">Builder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>path <span class="token operator">=</span> builder<span class="token punctuation">.</span>path<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>featureService <span class="token operator">=</span> builder<span class="token punctuation">.</span>featureService<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>description <span class="token operator">=</span> builder<span class="token punctuation">.</span>description<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>manufacture <span class="token operator">=</span> builder<span class="token punctuation">.</span>manufacture<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>model <span class="token operator">=</span> builder<span class="token punctuation">.</span>model<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>lifecycleRecruited <span class="token operator">=</span> builder<span class="token punctuation">.</span>lifecycleRecruited<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>lifecycleDecommissioned <span class="token operator">=</span> builder<span class="token punctuation">.</span>lifecycleDecommissioned<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>totalRecruited <span class="token operator">=</span> builder<span class="token punctuation">.</span>totalRecruited<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>totalDecommissioned <span class="token operator">=</span> builder<span class="token punctuation">.</span>totalDecommissioned<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre>  
</div><p>Finally, by using the Builder pattern, we tremendously simplified the client&#39;s action to use the wrapped command. Here is the usage:</p>
<div class="codeblock">
  <pre class="language-java"><span class="token class-name">MeterSimulator</span> meterSimulator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MeterSimulator<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span>METER_SIMULATOR_PATH<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withManufacture</span><span class="token punctuation">(</span><span class="token string">"Zebra"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withDescription</span><span class="token punctuation">(</span><span class="token string">"From Integration Test"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withModel</span><span class="token punctuation">(</span><span class="token string">"foo1"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withTotalDecommissioned</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
meterSimulator<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre>  
</div></article><h2 class="github_14b9dxr"><a target="_blank" href="https://github.com/zhenyanghua/zhenyanghua.github.io/blob/master/posts/2018/12/wrap-a-command-with-builder-pattern/index.md">Read on GitHub</a></h2></div></main></div><script type="isodata"></script>
  <script type="module" src="/index.32e33bb9.js"></script>
</body>
</html>

