import{m as e}from"../index.38ef91ca.js";import"./time.daaab1ba.js";import{P as t}from"./index.8a0fdf57.js";export default function(){return e`<${t} ...${{title:"Java Servlet CORS Filter with  Preflight  Options",date:"2018-04-26T17:00:00.000Z"}}>
      <article dangerouslySetInnerHTML=${{__html:'<h2>\n  <a id="a-cors-filter-determines-what-types-of-access-control-header-will-be-set-for-the-server-response-to-the-client-39-s-request-however-when-the-resource-being-accessed-is-behind-a-security-layer-in-order-to-send-the-payload-to-the-security-filters-an-optional-request-by-browsers-is-sent-to-the-server-before-the-actual-request-this-lesson-presents-one-implementation-of-a-cors-filter-that-supports-preflight-options-request-" class="anchor" aria-hidden="true" href="#a-cors-filter-determines-what-types-of-access-control-header-will-be-set-for-the-server-response-to-the-client-39-s-request-however-when-the-resource-being-accessed-is-behind-a-security-layer-in-order-to-send-the-payload-to-the-security-filters-an-optional-request-by-browsers-is-sent-to-the-server-before-the-actual-request-this-lesson-presents-one-implementation-of-a-cors-filter-that-supports-preflight-options-request-">\n    <svg class="icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg>\n  </a>A CORS filter determines what types of access control header will be set for the server response to the client&#39;s request.  However, when the resource being accessed is behind a security layer, in order to send the payload to the security filters, an optional request by browsers is sent to the server before the actual request. This lesson presents one implementation of a CORS filter that supports preflight options request.</h2><h2>\n  <a id="story" class="anchor" aria-hidden="true" href="#story">\n    <svg class="icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg>\n  </a>Story</h2><p>The following code is an implementation of a CORS filter that just works fine without a security layer.</p>\n<div class="codeblock">\n  <pre>public class SimpleCorsFilter implements Filter {\n\n    @Override\n    public void init(final FilterConfig filterConfig) throws ServletException {\n    }\n\n    @Override\n    public void doFilter(final ServletRequest request, final ServletResponse response, final FilterChain chain) throws IOException, ServletException {\n        HttpServletResponse resp = (HttpServletResponse) response;\n        HttpServletRequest req = (HttpServletRequest) request;\n        resp.setHeader(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;);\n        resp.setHeader(&quot;Access-Control-Allow-Methods&quot;, &quot;*&quot;);\n        resp.setHeader(&quot;Access-Control-Max-Age&quot;, &quot;3600&quot;);\n        resp.setHeader(&quot;Access-Control-Allow-Headers&quot;, &quot;x-requested-with, authorization, Content-Type, Authorization, credential, X-XSRF-TOKEN&quot;);\n\n    }\n\n    @Override\n    public void destroy() {\n    }\n}</pre>\n</div><p>However, to use this filter with secured resources, the preflight check will raise a <strong>401 Unauthorized</strong> error in the browser. That is because the prelight <code>OPTIONS</code> request doesn&#39;t have any authorization header with it to be sent to the server.</p>\n<h2>\n  <a id="solution" class="anchor" aria-hidden="true" href="#solution">\n    <svg class="icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg>\n  </a>Solution</h2><p>Intercept the preflight <code>OPTIONS</code> response and set the response as a 2XX status code.</p>\n<div class="codeblock">\n  <pre>    @Override\n    public void doFilter(final ServletRequest request, final ServletResponse response, final FilterChain chain) throws IOException, ServletException {\n      // set headers.. omitted for brevity\n\n        if (&quot;OPTIONS&quot;.equalsIgnoreCase(req.getMethod())) {\n            resp.setStatus(HttpServletResponse.SC_OK);\n        } else {\n            chain.doFilter(request, response);\n        }\n    }</pre>\n</div><h2>\n  <a id="lesson-learnt" class="anchor" aria-hidden="true" href="#lesson-learnt">\n    <svg class="icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg>\n  </a>Lesson Learnt</h2><ul>\n<li><code>OPTIONS</code> preflight check could be intercepted and set a success status code back to the client to proceed with the actual request.</li>\n</ul>\n'}}/>
    </${t}>`}